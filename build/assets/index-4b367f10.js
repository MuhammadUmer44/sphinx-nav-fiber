import{g as te,a as se,s as A,_ as S,a7 as Pe,r as x,b as ne,j as s,d as oe,c as M,e as re,u as me,aQ as Fe,aY as Y,aZ as ae,a5 as pe,a_ as Ee,a$ as Me,f as w,F as m,T as P,i as Ae,k as ge,K as Ie,C as ie,h as v,b0 as De,b1 as X,U as ee,b2 as Le,Z as Ge,V as T,b3 as Oe,ax as _e,b4 as We,x as Ve,I as Ue}from"./index-6865c215.js";import{B as ce}from"./index-41b2a75e.js";import{u as E}from"./index-27c0e8db.js";import{o as qe,h as Ke,c as ye,F as be,C as Z,p as He,i as Ye,I as we,B as U,n as Ze}from"./react-toastify.esm-22bb4a54.js";import{B as je,T as Qe,a as Je}from"./index-15aedafe.js";import{T as H}from"./index-e40a00bc.js";import{e as Xe,A as ve}from"./index-e2b6f25f.js";import{p as et,c as tt}from"./index-30d16895.js";import{a as ue,N as st,S as nt,b as G,T as ot,c as rt,E as at,A as it}from"./index-026da7c2.js";import{D as ct,P as Se}from"./PlusIcon-8d1cf88e.js";import{u as lt,a as dt}from"./Popover-f9928c08.js";import{u as pt}from"./index-a81519a3.js";import{L as ut,m as ht,b as ft,S as xt,H as mt,C as gt}from"./Selection-53633c89.js";import{L as yt}from"./index-34b6b518.js";import{M as bt,a as wt}from"./NoFilterResultIcon-e651ea7b.js";import"./useSlotProps-3d116945.js";import"./index.esm-6af15a5e.js";import"./InfoIcon-bad0ebb4.js";import"./Popper-3ee49886.js";import"./generateCategoricalChart-c02bec87.js";import"./index-29450604.js";import"./CheckIcon-c555d9ea.js";function jt(e){return te("PrivateSwitchBase",e)}se("PrivateSwitchBase",["root","checked","disabled","input","edgeStart","edgeEnd"]);const vt=["autoFocus","checked","checkedIcon","className","defaultChecked","disabled","disableFocusRipple","edge","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"],St=e=>{const{classes:t,checked:o,disabled:n,edge:r}=e,i={root:["root",o&&"checked",n&&"disabled",r&&`edge${M(r)}`],input:["input"]};return re(i,jt,t)},kt=A(qe)(({ownerState:e})=>S({padding:9,borderRadius:"50%"},e.edge==="start"&&{marginLeft:e.size==="small"?-3:-12},e.edge==="end"&&{marginRight:e.size==="small"?-3:-12})),Ct=A("input",{shouldForwardProp:Pe})({cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}),$t=x.forwardRef(function(t,o){const{autoFocus:n,checked:r,checkedIcon:i,className:p,defaultChecked:u,disabled:d,disableFocusRipple:h=!1,edge:c=!1,icon:a,id:l,inputProps:f,inputRef:g,name:B,onBlur:y,onChange:N,onFocus:I,readOnly:D,required:_=!1,tabIndex:b,type:j,value:$}=t,C=ne(t,vt),[K,L]=pt({controlled:r,default:!!u,name:"SwitchBase",state:"checked"}),R=lt(),ze=z=>{I&&I(z),R&&R.onFocus&&R.onFocus(z)},Te=z=>{y&&y(z),R&&R.onBlur&&R.onBlur(z)},Ne=z=>{if(z.nativeEvent.defaultPrevented)return;const de=z.target.checked;L(de),N&&N(z,de)};let W=d;R&&typeof W>"u"&&(W=R.disabled);const Re=j==="checkbox"||j==="radio",Q=S({},t,{checked:K,disabled:W,disableFocusRipple:h,edge:c}),le=St(Q);return s.jsxs(kt,S({component:"span",className:oe(le.root,p),centerRipple:!0,focusRipple:!h,disabled:W,tabIndex:null,role:void 0,onFocus:ze,onBlur:Te,ownerState:Q,ref:o},C,{children:[s.jsx(Ct,S({autoFocus:n,checked:r,defaultChecked:u,className:le.input,disabled:W,id:Re?l:void 0,name:B,onChange:Ne,readOnly:D,ref:g,required:_,ownerState:Q,tabIndex:b,type:j},j==="checkbox"&&$===void 0?{}:{value:$},f)),K?i:a]}))}),Bt=$t,zt=x.createContext(),he=zt;function Tt(e){return te("MuiGrid",e)}const Nt=[0,1,2,3,4,5,6,7,8,9,10],Rt=["column-reverse","column","row-reverse","row"],Pt=["nowrap","wrap-reverse","wrap"],V=["auto",!0,1,2,3,4,5,6,7,8,9,10,11,12],Ft=se("MuiGrid",["root","container","item","zeroMinWidth",...Nt.map(e=>`spacing-xs-${e}`),...Rt.map(e=>`direction-xs-${e}`),...Pt.map(e=>`wrap-xs-${e}`),...V.map(e=>`grid-xs-${e}`),...V.map(e=>`grid-sm-${e}`),...V.map(e=>`grid-md-${e}`),...V.map(e=>`grid-lg-${e}`),...V.map(e=>`grid-xl-${e}`)]),q=Ft,Et=["className","columns","columnSpacing","component","container","direction","item","rowSpacing","spacing","wrap","zeroMinWidth"];function O(e){const t=parseFloat(e);return`${t}${String(e).replace(String(t),"")||"px"}`}function Mt({theme:e,ownerState:t}){let o;return e.breakpoints.keys.reduce((n,r)=>{let i={};if(t[r]&&(o=t[r]),!o)return n;if(o===!0)i={flexBasis:0,flexGrow:1,maxWidth:"100%"};else if(o==="auto")i={flexBasis:"auto",flexGrow:0,flexShrink:0,maxWidth:"none",width:"auto"};else{const p=Y({values:t.columns,breakpoints:e.breakpoints.values}),u=typeof p=="object"?p[r]:p;if(u==null)return n;const d=`${Math.round(o/u*1e8)/1e6}%`;let h={};if(t.container&&t.item&&t.columnSpacing!==0){const c=e.spacing(t.columnSpacing);if(c!=="0px"){const a=`calc(${d} + ${O(c)})`;h={flexBasis:a,maxWidth:a}}}i=S({flexBasis:d,flexGrow:0,maxWidth:d},h)}return e.breakpoints.values[r]===0?Object.assign(n,i):n[e.breakpoints.up(r)]=i,n},{})}function At({theme:e,ownerState:t}){const o=Y({values:t.direction,breakpoints:e.breakpoints.values});return ae({theme:e},o,n=>{const r={flexDirection:n};return n.indexOf("column")===0&&(r[`& > .${q.item}`]={maxWidth:"none"}),r})}function ke({breakpoints:e,values:t}){let o="";Object.keys(t).forEach(r=>{o===""&&t[r]!==0&&(o=r)});const n=Object.keys(e).sort((r,i)=>e[r]-e[i]);return n.slice(0,n.indexOf(o))}function It({theme:e,ownerState:t}){const{container:o,rowSpacing:n}=t;let r={};if(o&&n!==0){const i=Y({values:n,breakpoints:e.breakpoints.values});let p;typeof i=="object"&&(p=ke({breakpoints:e.breakpoints.values,values:i})),r=ae({theme:e},i,(u,d)=>{var h;const c=e.spacing(u);return c!=="0px"?{marginTop:`-${O(c)}`,[`& > .${q.item}`]:{paddingTop:O(c)}}:(h=p)!=null&&h.includes(d)?{}:{marginTop:0,[`& > .${q.item}`]:{paddingTop:0}}})}return r}function Dt({theme:e,ownerState:t}){const{container:o,columnSpacing:n}=t;let r={};if(o&&n!==0){const i=Y({values:n,breakpoints:e.breakpoints.values});let p;typeof i=="object"&&(p=ke({breakpoints:e.breakpoints.values,values:i})),r=ae({theme:e},i,(u,d)=>{var h;const c=e.spacing(u);return c!=="0px"?{width:`calc(100% + ${O(c)})`,marginLeft:`-${O(c)}`,[`& > .${q.item}`]:{paddingLeft:O(c)}}:(h=p)!=null&&h.includes(d)?{}:{width:"100%",marginLeft:0,[`& > .${q.item}`]:{paddingLeft:0}}})}return r}function Lt(e,t,o={}){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[o[`spacing-xs-${String(e)}`]];const n=[];return t.forEach(r=>{const i=e[r];Number(i)>0&&n.push(o[`spacing-${r}-${String(i)}`])}),n}const Gt=A("div",{name:"MuiGrid",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e,{container:n,direction:r,item:i,spacing:p,wrap:u,zeroMinWidth:d,breakpoints:h}=o;let c=[];n&&(c=Lt(p,h,t));const a=[];return h.forEach(l=>{const f=o[l];f&&a.push(t[`grid-${l}-${String(f)}`])}),[t.root,n&&t.container,i&&t.item,d&&t.zeroMinWidth,...c,r!=="row"&&t[`direction-xs-${String(r)}`],u!=="wrap"&&t[`wrap-xs-${String(u)}`],...a]}})(({ownerState:e})=>S({boxSizing:"border-box"},e.container&&{display:"flex",flexWrap:"wrap",width:"100%"},e.item&&{margin:0},e.zeroMinWidth&&{minWidth:0},e.wrap!=="wrap"&&{flexWrap:e.wrap}),At,It,Dt,Mt);function Ot(e,t){if(!e||e<=0)return[];if(typeof e=="string"&&!Number.isNaN(Number(e))||typeof e=="number")return[`spacing-xs-${String(e)}`];const o=[];return t.forEach(n=>{const r=e[n];if(Number(r)>0){const i=`spacing-${n}-${String(r)}`;o.push(i)}}),o}const _t=e=>{const{classes:t,container:o,direction:n,item:r,spacing:i,wrap:p,zeroMinWidth:u,breakpoints:d}=e;let h=[];o&&(h=Ot(i,d));const c=[];d.forEach(l=>{const f=e[l];f&&c.push(`grid-${l}-${String(f)}`)});const a={root:["root",o&&"container",r&&"item",u&&"zeroMinWidth",...h,n!=="row"&&`direction-xs-${String(n)}`,p!=="wrap"&&`wrap-xs-${String(p)}`,...c]};return re(a,Tt,t)},Wt=x.forwardRef(function(t,o){const n=me({props:t,name:"MuiGrid"}),{breakpoints:r}=Fe(),i=Xe(n),{className:p,columns:u,columnSpacing:d,component:h="div",container:c=!1,direction:a="row",item:l=!1,rowSpacing:f,spacing:g=0,wrap:B="wrap",zeroMinWidth:y=!1}=i,N=ne(i,Et),I=f||g,D=d||g,_=x.useContext(he),b=c?u||12:_,j={},$=S({},N);r.keys.forEach(L=>{N[L]!=null&&(j[L]=N[L],delete $[L])});const C=S({},i,{columns:b,container:c,direction:a,item:l,rowSpacing:I,columnSpacing:D,wrap:B,zeroMinWidth:y,spacing:g},j,{breakpoints:r.keys}),K=_t(C);return s.jsx(he.Provider,{value:b,children:s.jsx(Gt,S({ownerState:C,className:oe(K.root,p),as:h,ref:o},$))})}),F=Wt;function Vt(e){return te("MuiSwitch",e)}const Ut=se("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),k=Ut,qt=["className","color","edge","size","sx"],Kt=e=>{const{classes:t,edge:o,size:n,color:r,checked:i,disabled:p}=e,u={root:["root",o&&`edge${M(o)}`,`size${M(n)}`],switchBase:["switchBase",`color${M(r)}`,i&&"checked",p&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=re(u,Vt,t);return S({},t,d)},Ht=A("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.root,o.edge&&t[`edge${M(o.edge)}`],t[`size${M(o.size)}`]]}})(({ownerState:e})=>S({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},e.edge==="start"&&{marginLeft:-8},e.edge==="end"&&{marginRight:-8},e.size==="small"&&{width:40,height:24,padding:7,[`& .${k.thumb}`]:{width:16,height:16},[`& .${k.switchBase}`]:{padding:4,[`&.${k.checked}`]:{transform:"translateX(16px)"}}})),Yt=A(Bt,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:o}=e;return[t.switchBase,{[`& .${k.input}`]:t.input},o.color!=="default"&&t[`color${M(o.color)}`]]}})(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${k.checked}`]:{transform:"translateX(20px)"},[`&.${k.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${k.checked} + .${k.track}`]:{opacity:.5},[`&.${k.disabled} + .${k.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${k.input}`]:{left:"-100%",width:"300%"}}),({theme:e,ownerState:t})=>S({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:pe(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},t.color!=="default"&&{[`&.${k.checked}`]:{color:(e.vars||e).palette[t.color].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t.color].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:pe(e.palette[t.color].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${k.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t.color}DisabledColor`]:`${e.palette.mode==="light"?Ee(e.palette[t.color].main,.62):Me(e.palette[t.color].main,.55)}`}},[`&.${k.checked} + .${k.track}`]:{backgroundColor:(e.vars||e).palette[t.color].main}})),Zt=A("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`})),Qt=A("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"})),Jt=x.forwardRef(function(t,o){const n=me({props:t,name:"MuiSwitch"}),{className:r,color:i="primary",edge:p=!1,size:u="medium",sx:d}=n,h=ne(n,qt),c=S({},n,{color:i,edge:p,size:u}),a=Kt(c),l=s.jsx(Qt,{className:a.thumb,ownerState:c});return s.jsxs(Ht,{className:oe(a.root,r),sx:d,ownerState:c,children:[s.jsx(Yt,S({type:"checkbox",icon:l,checkedIcon:l,ref:o,ownerState:c},h,{classes:S({},a,{root:a.switchBase})})),s.jsx(Zt,{className:a.track,ownerState:c})]})}),Xt=Jt,es=({onClose:e})=>{const[t]=Ae(n=>[n.graphStyle]),o=()=>{localStorage.setItem("graphStyle",t),e()};return s.jsxs(ts,{direction:"column",children:[s.jsx(ss,{children:"Default graph view:"}),s.jsx(Ke,{}),s.jsx(m,{mt:308,children:s.jsx(je,{kind:"big",onClick:o,children:"Save Changes"})})]})},ts=w(m)`
  display: flex;
  gap: 10px;
  padding: 36px;
`,ss=w(P)`
  font-family: Barlow;
  font-size: 13px;
  font-weight: 400;
`,ns=({initialValues:e})=>{const t=ye({defaultValues:e,mode:"onSubmit"}),{isSubmitting:o}=t.formState,n=ge(i=>i.setAppMetaData),r=t.handleSubmit(async i=>{try{(await Ie(i)).status==="success"&&n(i)}catch(p){console.log(p),console.warn(p)}});return s.jsx(be,{...t,children:s.jsx(rs,{id:"add-node-form",onSubmit:r,children:s.jsxs(s.Fragment,{children:[s.jsxs(m,{children:[s.jsx(m,{pt:20,children:s.jsx(H,{id:"cy-about-title-id",label:"Graph Title",maxLength:50,name:"title",placeholder:"Type graph title here...",rules:{...ie}})}),s.jsx(m,{pt:20,children:s.jsx(H,{id:"cy-about-id",label:"Graph Description",maxLength:100,name:"description",placeholder:"Type graph description here..."})})]}),s.jsx(m,{mt:210,py:24,children:o?s.jsx(os,{children:s.jsx(Z,{color:v.white,size:20})}):s.jsx(je,{disabled:o,id:"add-node-submit-cta",kind:"big",type:"submit",children:"Save Changes"})})]})})})},os=w(m).attrs({align:"center",background:"primaryButton",borderRadius:8,justify:"center"})`
  padding: 16px 24px;
  opacity: 0.5;
`,rs=w.form`
  padding: 36px;
`,as=/^[a-z0-9_]+$/,is=({parentParam:e})=>{const[t,o]=x.useState(!1),[n,r]=x.useState([]),{fields:i,append:p,replace:u,remove:d}=He({name:"attributes"}),{setValue:h,watch:c}=Ye();return x.useEffect(()=>{const a=async()=>{try{let l=[{required:!1,type:"string",key:""}];if(e!==st.value.toLowerCase()){o(!0);const f=await De(e);l=et(f)}u(l),r(l)}catch(l){console.warn(l)}finally{o(!1)}};n.length===0&&a()},[e,h,u,n.length]),s.jsxs(s.Fragment,{children:[t?s.jsx(m,{align:"center",children:s.jsx(Z,{color:v.SECONDARY_BLUE,size:"30"})}):s.jsx(cs,{py:8,children:s.jsx(F,{container:!0,spacing:2,children:i.map((a,l)=>{const f=c(`attributes[${l}].type`),g=c(`attributes[${l}].required`),B=a.isNew||!1;return s.jsxs(x.Fragment,{children:[s.jsx(F,{item:!0,xs:5,children:s.jsx(H,{autoComplete:"off",className:"text-input",disabled:!B,id:"cy-item-name",maxLength:50,name:`attributes.${l}.key`,placeholder:"Enter value",rules:{...ie,pattern:{message:"Please avoid special characters, spaces and uppercase",value:as}}})}),s.jsx(F,{item:!0,xs:4,children:s.jsx(ve,{onSelect:y=>h(`attributes[${l}].type`,y==null?void 0:y.value),options:ue,selectedValue:ue.find(y=>y.value===f)})}),s.jsxs(F,{item:!0,xs:3,children:[s.jsx(Xt,{checked:g,disabled:!1,name:`attributes.${l}.required`,onChange:y=>h(`attributes[${l}].required`,y.target.checked),size:"small"}),s.jsx(we,{onClick:()=>d(l),children:s.jsx(ct,{})})]})]},a.id)})})}),s.jsx(m,{align:"flex-start",py:12,children:s.jsx(U,{onClick:()=>p({key:"",type:"string",required:!0,isNew:!0}),size:"medium",startIcon:s.jsx(Se,{}),variant:"contained",children:"Add Attribute"})})]})},cs=w(m)`
  max-height: 260px;
  overflow: auto;
  width: calc(100% + 20px);
`,ls=({parent:e})=>{const t=e;return s.jsxs(m,{children:[s.jsx(m,{direction:"row",mb:10,children:s.jsxs(F,{container:!0,spacing:2,children:[s.jsx(F,{item:!0,xs:5,children:s.jsx(J,{style:{marginRight:180},children:"Attributes"})}),s.jsx(F,{item:!0,xs:4,children:s.jsx(J,{style:{marginRight:130},children:"Type"})}),s.jsx(F,{item:!0,xs:3,children:s.jsx(J,{children:"Required"})})]})}),t&&s.jsx(is,{parentParam:t},t)]})},J=w(P)`
  font-size: 15px;
  color: gray;
`,ds={type:"",parent:""},ps=async(e,t=!1)=>{try{const{attributes:o,...n}=e,r={...n,...tt(o)};let i;if(t?i=await ee.put("/schema",JSON.stringify(r),{}):i=await ee.post("/schema",JSON.stringify(r),{}),i.error){const{message:p}=i.error;throw new Error(p)}}catch(o){let n=X;if(o.status===400){const r=await o.json();n=r.errorCode||(r==null?void 0:r.status)||X}else o instanceof Error&&(n=o.message);throw new Error(n)}},us=({onSchemaCreate:e,selectedSchema:t,onDelete:o})=>{const{close:n,visible:r}=E("addType"),i=ye({mode:"onChange",defaultValues:t?{type:t.type,parent:t.parent}:ds}),{watch:p,setValue:u,reset:d}=i,[h,c]=x.useState(!1),[a,l]=x.useState(!1),[f,g]=x.useState(null);x.useEffect(()=>()=>{d()},[r,d]);const B=b=>b.charAt(0).toUpperCase()+b.slice(1);x.useEffect(()=>{t||(async()=>{l(!0);try{const $=(await Le()).schemas.filter(C=>!C.is_deleted).map(C=>(C==null?void 0:C.type)==="thing"?{label:"No Parent",value:C.type}:{label:B(C.type),value:C.type});g($)}catch(j){console.warn(j)}finally{l(!1)}})()},[t]);const y=p("parent"),N=()=>{n()},I=async()=>{if(t!=null&&t.type)try{await ee.delete(`/schema/${t.type}`),o(t.type),n()}catch(b){console.warn(b)}},D=i.handleSubmit(async b=>{c(!1);try{await ps(b,!!t),e({type:b.type,parent:y||""}),N()}catch(j){if((j==null?void 0:j.status)===400){const $=await j.json();$.errorCode||$!=null&&$.status||X}else j instanceof Error&&j.message}finally{c(!1)}}),_=()=>f==null?void 0:f.find(b=>b.value===y);return s.jsx(be,{...i,children:s.jsxs("form",{id:"add-type-form",onSubmit:D,children:[s.jsxs(m,{children:[s.jsx(m,{align:"center",direction:"row",justify:"space-between",mb:18,children:s.jsx(m,{align:"center",direction:"row",children:s.jsx(P,{children:"Enter details"})})}),t?s.jsx(m,{mb:20,children:s.jsxs(P,{kind:"headingBold",children:["Parent: ",t.parent]})}):s.jsxs(s.Fragment,{children:[s.jsx(m,{mb:20,children:s.jsx(P,{children:"Select Parent"})}),s.jsx(m,{direction:"row",mb:20,children:s.jsx(ve,{autoFocus:!t,disabled:a,isLoading:a,onSelect:b=>u("parent",(b==null?void 0:b.value)||""),options:f,selectedValue:_()},y)})]}),t?s.jsx(m,{mb:20,children:s.jsxs(P,{kind:"headingBold",children:["Type: ",t.type]})}):s.jsxs(s.Fragment,{children:[s.jsx(m,{mb:4,children:s.jsx(P,{children:"Type name"})}),s.jsx(m,{mb:12,children:s.jsx(H,{id:"cy-item-name",maxLength:250,name:"type",placeholder:"Enter type name",rules:{...ie},value:y})})]})]}),s.jsx(ls,{parent:t?t.type:y}),s.jsxs(m,{direction:"row",justify:"space-between",mt:20,children:[t?s.jsx(hs,{color:"secondary",onClick:I,size:"large",style:{marginRight:20},variant:"contained",children:"Delete"}):null,s.jsx(U,{color:"secondary",disabled:h,onClick:D,size:"large",startIcon:h?s.jsx(Z,{color:v.white,size:24}):null,variant:"contained",children:"Save"})]})]})})},hs=w(U)`
  && {
    color: ${v.primaryRed};
    background-color: rgba(237, 116, 116, 0.1);

    &:hover,
    &:active,
    &:focus {
      color: ${v.primaryRed};
      background-color: rgba(237, 116, 116, 0.2);
    }
  }
`,fs=({onSchemaCreate:e,selectedSchema:t,onDelete:o,onClose:n})=>{const{close:r}=E("blueprintGraph"),i=()=>{r(),n()};return s.jsx(ce,{id:"addType",kind:"regular",onClose:i,preventOutsideClose:!0,children:s.jsx(us,{onDelete:o,onSchemaCreate:e,selectedSchema:t})})},xs={schemas:[],links:[]},Ce=Ge(e=>({...xs,setSchemas:t=>{e({schemas:t})},setSchemaLinks:t=>{e({links:t})}})),ms=e=>{const t=e.find(i=>i.type==="Thing"),o=[],n=2,r=(i,p,u,d=0,h=0)=>{const c=e.find(a=>a.ref_id===i);if(c){const a=p?2*Math.PI/p:0,l=u*a+d,f=h*n*Math.cos(l),g=h*n*Math.sin(l);o.push({...c,x:f,y:g,z:0}),c.children.forEach((B,y)=>{r(B,c.children.length,y,l,h+1)})}};return t!=null&&t.ref_id&&r(t==null?void 0:t.ref_id,0,0),o},gs=new T,fe=x.forwardRef(function({start:t=[0,0,0],end:o=[0,0,0],mid:n,segments:r=20,...i},p){const u=x.useRef(null),[d]=x.useState(()=>new Oe(void 0,void 0,void 0)),h=x.useCallback((a,l,f,g=20)=>(a instanceof T?d.v0.copy(a):d.v0.set(...a),l instanceof T?d.v2.copy(l):d.v2.set(...l),f instanceof T?d.v1.copy(f):d.v1.copy(d.v0.clone().add(d.v2.clone().sub(d.v0)).add(gs.set(0,d.v0.y-d.v2.y,0))),d.getPoints(g)),[]);x.useLayoutEffect(()=>{u.current.setPoints=(a,l,f)=>{const g=h(a,l,f);u.current.geometry&&u.current.geometry.setPositions(g.map(B=>B.toArray()).flat())}},[]);const c=x.useMemo(()=>h(t,o,n,r),[t,o,n,r]);return x.createElement(ut,S({ref:ht([u,p]),points:c},i))}),$e=({links:e})=>{const t=x.useRef(null),o=x.useMemo(()=>{const n=[];return e.forEach((r,i)=>{const p=i%2===0?1:-1,{start:u,end:d}=r,h=new T(u.x,u.y,u.z),c=new T(d.x,d.y,d.z),a=new T(0,p*.25,0),l=new T(0,p*.25,0),f=h.clone().add(a),g=c.clone().add(l);n.push({start:f,end:g})}),n},[e]);return ft((n,r)=>{t.current&&t.current.children.forEach(i=>{const u=i.material;u!=null&&u.uniforms&&"dashOffset"in u.uniforms&&(u.uniforms.dashOffset.value-=r*10)})}),s.jsx("group",{ref:t,children:o.map((n,r)=>s.jsxs(x.Fragment,{children:[s.jsx(fe,{...n,color:"white",dashed:!0,dashScale:50,gapSize:20}),s.jsx(fe,{...n,color:"white",lineWidth:.5,opacity:.1,transparent:!0})]},r))})};$e.displayName="Lines";const ys=new _e(4,4,4),Be=x.memo(({node:e})=>{const[t]=x.useState(ys);return x.useEffect(()=>function(){t.dispose()},[t]),s.jsxs(xt,{children:[!1,s.jsx("group",{position:new T(e.x,e.y,e.z),children:s.jsx(mt,{center:!0,sprite:!0,zIndexRange:[0,0],children:s.jsx(bs,{children:e.type})})})]})});Be.displayName="Node";const bs=w(m)`
  width: 50px;
  height: 50px;
  border-radius: 50%;
  color: ${v.white};
  border: 1px solid ${v.white};
  align-items: center;
  justify-content: center;
`,ws=({nodes:e})=>s.jsx(s.Fragment,{children:e.map(t=>s.jsx(Be,{node:{x:t.x,y:t.y,z:t.z,id:t.ref_id||"",type:t.type||""}},t.ref_id))}),js=({onSchemaCreate:e,selectedSchema:t,onDelete:o})=>{console.log(e,t,o);const[n,r]=Ce(a=>[a.schemas,a.links]),i=n.filter(a=>a.ref_id&&!a.is_deleted),p=[];i.forEach(a=>{p.some(l=>l.ref_id===a.ref_id)||p.push(a)});const u=p.map(a=>({...a,children:p.filter(l=>l.parent===a.type).map(l=>l.ref_id||"")})),d=ms(u),c=r.filter(a=>a.edge_type==="CHILD_OF"&&d.some(l=>l.ref_id===a.source||l.ref_id===a.target)).map(a=>{const l=d.find(g=>g.ref_id===a.source)||{x:0,y:0,z:0},f=d.find(g=>g.ref_id===a.target)||{x:0,y:0,z:0};return{...a,start:{x:l.x,y:l.y,z:l.z},end:{x:f.x,y:f.y,z:f.z}}});return s.jsx(vs,{children:s.jsxs(gt,{camera:{zoom:80},id:"schema-canvas",orthographic:!0,children:[s.jsx(yt,{}),s.jsx($e,{links:c}),s.jsx(s.Fragment,{children:s.jsx(ws,{nodes:d})})]})})},vs=w(m)`
  flex: 1 1 100%;
  justify-content: center;
  align-items: center;
`,Ss=({onSchemaCreate:e,selectedSchema:t,onDelete:o,onClose:n})=>{const{close:r}=E("blueprintGraph"),i=()=>{r(),n()};return s.jsx(ce,{id:"blueprintGraph",kind:"full",onClose:i,preventOutsideClose:!0,children:s.jsx(js,{onDelete:o,onSchemaCreate:e,selectedSchema:t})})};function ks(e){return e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()}const Cs=({schema:e,click:t})=>s.jsx(s.Fragment,{children:s.jsxs(nt,{children:[s.jsx(G,{className:"empty"}),s.jsx(G,{children:ks(e.type??"")}),s.jsx(G,{children:s.jsx(we,{disabled:(e==null?void 0:e.type)==="thing",onClick:t,children:s.jsx(ot,{"data-testid":"EditIcon"})})})]})}),$s=x.memo(Cs),Bs=({schemas:e,setSelectedSchema:t})=>{const{open:o}=E("addType"),n=x.useCallback(a=>{o(),t(a)},[o,t]),[r,i]=x.useState(null),p=a=>{i(a.currentTarget)},u=()=>{i(null)},d=()=>{u()},h=!!r,c=h?"popover":void 0;return s.jsxs(s.Fragment,{children:[s.jsxs(bt,{component:"table",children:[s.jsx(rt,{children:s.jsxs(wt,{component:"tr",children:[s.jsx(G,{className:"empty"}),s.jsx(G,{children:"Type"}),s.jsx(G,{className:"empty"})]})}),s.jsx("tbody",{children:e==null?void 0:e.map(a=>s.jsx($s,{click:p,schema:a},a==null?void 0:a.type))})]}),s.jsxs(zs,{anchorEl:r,anchorOrigin:{vertical:"bottom",horizontal:"center"},id:c,onClose:u,open:h,transformOrigin:{vertical:"top",horizontal:"center"},children:[s.jsxs(xe,{onClick:()=>{n(e[0]),d()},children:[s.jsx(at,{}),"Edit"]}),s.jsxs(xe,{onClick:d,children:[s.jsx(it,{}),"Add Edge"]})]})]})},xe=w(m).attrs({direction:"row",px:12,py:8})`
  display: flex;
  align-items: center;
  justify-content: start;
  gap: 12px;
  cursor: pointer;
  background: ${v.BUTTON1};
  color: ${v.white};

  &:hover {
    background: ${v.BUTTON1_HOVER};
    color: ${v.GRAY3};
  }
`,zs=w(dt)`
  && {
    z-index: 9999;
  }
  .MuiPaper-root {
    min-width: 149px;
    color: ${v.GRAY3};
    box-shadow: 0px 1px 6px 0px rgba(0, 0, 0, 0.2);
    border-radius: 6px;
    z-index: 1;
    font-family: Barlow;
    font-size: 14px;
    font-weight: 500;
  }
`,Ts=()=>{const[e,t]=x.useState(!0),[o,n,r]=Ce(a=>[a.schemas,a.setSchemas,a.setSchemaLinks]),[i,p]=x.useState(null),{open:u}=E("blueprintGraph"),{open:d}=E("addType");x.useEffect(()=>{(async()=>{try{const l=await We();n(l.schemas.filter(f=>f.ref_id&&!f.is_deleted)),r(l.edges),t(!1)}catch(l){console.error("Error fetching data:",l),t(!1)}})()},[n,r]);const h=a=>{const l=o.some(f=>f.type===a.type);n(l?o.map(f=>f.type===a.type?a:f):[...o,a])},c=a=>{n(o.filter(l=>l.type!==a))};return s.jsxs(m,{grow:1,shrink:1,children:[s.jsxs(m,{direction:"row",justify:"space-between",px:37,py:21,children:[s.jsx(U,{color:"primary",onClick:d,size:"medium",startIcon:s.jsx(Se,{}),type:"submit",variant:"contained",children:"Create New Type"}),s.jsx(U,{onClick:u,startIcon:s.jsx(Ze,{}),variant:"text",children:"Graph View"})]}),s.jsx(Ns,{align:e?"center":"flex-start",justify:e?"center":"flex-start",children:e?s.jsx(Z,{color:v.white}):s.jsx(s.Fragment,{children:s.jsx(Bs,{schemas:o,setSelectedSchema:p})})}),s.jsx(fs,{onClose:()=>p(null),onDelete:c,onSchemaCreate:h,selectedSchema:i}),s.jsx(Ss,{onClose:()=>p(null),onDelete:c,onSchemaCreate:h,selectedSchema:i})]})},Ns=w(m)`
  min-height: 0;
  overflow: auto;
  flex: 1;
  width: 100%;
`,Rs=e=>{const{children:t,value:o,index:n,...r}=e;return o===n?s.jsx(Is,{"aria-labelledby":`simple-tab-${n}`,hidden:o!==n,id:`simple-tabpanel-${n}`,role:"tabpanel",...r,children:t}):null};function Ps(e){return{id:`simple-tab-${e}`,"aria-controls":`simple-tabpanel-${e}`}}const Fs=({onClose:e})=>{const[t,o]=x.useState(0),[n]=Ve(c=>[c.isAdmin,c.setPubKey]),r=Ue(c=>c.customSchemaFlag),i=ge(c=>c.appMetaData),p=()=>n?"Admin Settings":"Settings",u=({children:c})=>s.jsxs(Ms,{children:[s.jsx(m,{direction:"row",pt:3,children:s.jsx(Ls,{"data-testid":"setting-label",children:p()})}),c]}),d=(c,a)=>{o(a)},h=[...n?[{label:"General",component:ns}]:[],{label:"Appearance",component:es},...n&&r?[{label:"Blueprint",component:Ts}]:[]];return s.jsxs(Ds,{"data-testid":"settings-modal",direction:"column",children:[s.jsx(u,{children:s.jsx(Es,{"aria-label":"settings tabs",onChange:d,value:t,children:h.map((c,a)=>s.jsx(As,{disableRipple:!0,label:c.label,...Ps(a)},c.label))})}),h.map((c,a)=>s.jsx(Rs,{index:a,value:t,children:i&&s.jsx(c.component,{initialValues:i,onClose:e})},c.label))]})},Es=w(Qe)`
  && {
    .MuiTabs-indicator {
      background: ${v.primaryBlue};
    }
    padding-left: 34px;
  }
`,Ms=w(m)`
  border-radius: 9px 9px 0 0;
  background: rgb(22, 24, 30);
  padding: 40px 36px 0 0;
`,As=w(Je)`
  && {
    min-width: 0;
    width: auto;
    padding: 30px 0 19px;
    color: ${v.GRAY6};
    margin-right: 87px;
    font-family: Barlow;
    font-size: 16px;
    font-style: normal;
    font-weight: 500;
    text-align: left;

    &.Mui-selected {
      color: ${v.white};
    }
  }
`,Is=w(m)`
  display: flex;
  flex: 1;
  min-height: 495px;
  max-height: 495px;
  height: fit-content;
  min-width: 480px;
  overflow: hidden;
  border-radius: 9px;
`,Ds=w(m)`
  min-height: 0;
  flex: 1;
`,Ls=w(P)`
  font-size: 22px;
  font-weight: 600;
  font-family: Barlow;
  padding: 0 0 0 36px;
`,ln=()=>{const{close:e}=E("settings"),{visible:t}=E("addItem");return t?null:s.jsx(ce,{background:"BG1",id:"settings",noWrap:!0,onClose:e,preventOutsideClose:!0,children:s.jsx(Fs,{onClose:e})})};export{ln as SettingsModal};
